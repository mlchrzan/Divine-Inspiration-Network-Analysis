---
title: "bible project"
author: "kmr and mlc"
format: html
editor: visual
---

```{r libraries, message=FALSE}
library(tidyverse)
```

```{r load-data}
relation <- read_csv('relationship.csv')
label <- read_csv('label.csv')
person <- read_csv('person.csv')
personverse <- read_csv('personverse.csv')
book_info <- read_csv('bibledata_book.csv')
all_verses <- read.csv('alamopolyglot.csv')
```

```{r}
# Get a list of all data frames in the global environment
all_dfs <- Filter(function(x) is(x, "data.frame"), mget(ls()))

# Apply head() to each data frame
lapply(dfs, head)
```

```{r most-common}
relation |> 
  group_by(relationship_type) |> 
  summarize(count = n()) |> 
  ungroup() |> 
  arrange(desc(count))
```

```{r multiple-relationships}
multiple <- relation |> 
  mutate(relationship_type = as_factor(relationship_type)) |> 
  group_by(person_id_1, person_id_2) |> 
  summarize(n = n(), .groups = 'keep') |>
  ungroup() |> 
  filter(n > 1) |> 
  right_join(relates, by = join_by(person_id_1, person_id_2)) |> 
  filter(n > 1) |> 
  select(person_id_1, relationship_type, person_id_2, everything(), -n) 

# Most common
multiple |> 
  group_by(relationship_type) |> 
  summarize(n = n()) |> 
  ungroup() |> 
  arrange(desc(n))
```

```{r relationships-wide, warning=FALSE}
relation |> 
  select(person_id_1, person_id_2, relationship_type) |> 
  pivot_wider(names_from = relationship_type, 
              values_from = relationship_type) |> 
  unnest() |> 
  mutate(across(!starts_with("person_id"), ~if_else(!is.na(.), 1, 0)), 
         n_relates = rowSums(across(where(is.numeric)), na.rm = TRUE)) |> 
  select(person_id_1, person_id_2, n_relates, everything()) 
```

```{r family-identification}
family_types 
c('son', 
  'father', 
  'mother', 
  'daughter', 
  'brother', 
  'sister', 
  )

relates |> 
  select(relationship_type) |> 
  filter()
```
